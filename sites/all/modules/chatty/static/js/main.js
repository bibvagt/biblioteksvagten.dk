(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{215:function(e,t,n){e.exports=n(543)},499:function(e,t,n){},504:function(e,t,n){},513:function(e,t,n){},536:function(e,t,n){},542:function(e,t,n){},543:function(e,t,n){"use strict";n.r(t);n(216),n(217),n(218),n(219),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(242),n(96),n(243),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(260),n(261),n(263),n(264),n(266),n(267),n(268),n(134),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(283),n(284),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(307),n(308),n(309),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(328),n(329),n(330),n(331),n(332),n(333),n(334),n(335),n(336),n(337),n(338),n(190),n(339),n(340),n(192),n(341),n(342),n(343),n(344),n(193),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(370),n(372),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(390),n(391),n(392),n(393),n(394),n(395),n(396),n(397),n(398),n(399),n(400),n(401),n(402),n(403),n(404),n(142),n(405),n(406),n(407),n(408),n(409),n(410),n(411),n(413),n(414),n(415),n(416),n(417),n(418),n(419),n(420),n(422),n(423),n(424),n(425),n(426),n(427),n(428),n(429),n(430),n(431),n(432),n(433),n(434),n(435),n(436),n(437),n(438),n(439),n(440),n(441),n(442),n(443),n(444),n(445),n(446),n(448),n(449),n(450),n(451),n(452),n(453),n(454),n(455),n(456),n(457),n(458),n(459),n(460),n(461),n(462),n(463),n(464),n(465),n(466),n(467),n(468),n(469),n(470),n(471),n(472),n(473),n(474),n(475),n(476),n(477),n(478),n(479),n(481),n(482),n(483),n(484),n(485),n(486),n(487),n(488),n(489),n(490),n(491),n(492),n(493),n(494),n(495),n(496),n(498),n(203),n(499);var a=n(0),r=n.n(a),s=n(88),u=n.n(s),c=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(a[0]===e)return a[1]}return""},i=n(5),o=n(26),l=r.a.createContext(),d=function(e,t){switch(t.type){case"RESET_CHAT":return localStorage.removeItem("clientActiveQuestionId"),Object(o.a)({},e,{clientChat:null});case"SET_ACTIVE_CHAT":return localStorage.setItem("clientActiveQuestionId",t.payload),Object(o.a)({},e,{clientChat:{questionId:t.payload}});default:return e}},m=function(e){var t=e.children,n=Object(a.useReducer)(d,{clientChat:null}),s=Object(i.a)(n,2),u=s[0],c=s[1];return Object(a.useEffect)(function(){var e=localStorage.getItem("clientActiveQuestionId");e&&c({type:"SET_ACTIVE_CHAT",payload:e})},[]),r.a.createElement(l.Provider,{value:[u,c]},t)},b=(n(504),n(22)),f=n(14),v=n(15),E=n.n(v);function g(){var e=Object(f.a)(["\n  mutation CreateQuestionMutation(\n    $agencyId: String!\n    $agencyMail: String!\n    $authorName: String!\n    $authorEmail: String!\n    $subject: String!\n    $url: String!\n  ) {\n    createQuestion(\n      data: {\n        authorName: $authorName\n        authorEmail: $authorEmail\n        agencyMail: $agencyMail\n        agencyId: $agencyId\n        subject: $subject\n        url: $url\n      }\n    ) {\n      id\n      subject\n      authorName\n      status\n    }\n  }\n"]);return g=function(){return e},e}var p=E()(g()),q=function(e){var t=e.createQuestion,n=e.loading,s=Object(a.useRef)(""),u=Object(a.useRef)(""),i=Object(a.useRef)(""),o=n;return r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var n=c("agency_id"),a=c("agency_mail"),r=c("url");if(!n||!r)return alert("A needed param was not set.");t({variables:{agencyId:n,agencyMail:a,authorName:s.current.value,authorEmail:u.current.value,subject:i.current.value,url:r}})}},r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--question"},r.a.createElement("label",null,"Hvad vil du sp\xf8rge om?"),r.a.createElement("div",null,r.a.createElement("textarea",{autoFocus:!0,disabled:o,rows:"5",ref:i}))),r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--name"},r.a.createElement("label",null,"Dit navn",r.a.createElement("div",null,r.a.createElement("input",{type:"text",disabled:o,ref:s,required:!0})))),r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--email"},r.a.createElement("label",null,"Din e-mail adresse",r.a.createElement("div",null,r.a.createElement("input",{type:"email",disabled:o,ref:u,required:!0})))),r.a.createElement("input",{type:"submit",value:"Sp\xf8rg nu"}))},I=function(){var e=Object(a.useContext)(l),t=Object(i.a)(e,2)[1];return r.a.createElement("div",{className:"question-form"},r.a.createElement(b.b,{mutation:p},function(e,n){var a=n.loading,s=n.data;return s&&s.createQuestion.id&&t({type:"SET_ACTIVE_CHAT",payload:s.createQuestion.id}),r.a.createElement(q,{createQuestion:e,loading:a})}))};n(513);function j(){var e=Object(f.a)(["\n  query QuestionQuery($questionId: ID!) {\n    question(questionId: $questionId) {\n      id\n      subject\n      authorName\n      authorEmail\n      consultant\n      status\n      source\n      lastHeartbeatAt\n      createdAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return j=function(){return e},e}var y=E()(j());function O(){var e=Object(f.a)(["\n  mutation CreateMessageMutation($questionId: ID!, $sentFrom: String!, $text: String!) {\n    createMessage(questionId: $questionId, data: { text: $text, sentFrom: $sentFrom }) {\n      id\n      text\n      sentFrom\n      createdAt\n      question {\n        id\n        authorName\n      }\n    }\n  }\n"]);return O=function(){return e},e}var h=E()(O()),_=r.a.createContext(),S=function(e,t){switch(t.type){case"RESET_CHAT":return localStorage.removeItem("backendActiveQuestionId"),Object(o.a)({},e,{backendChat:null});case"SET_ACTIVE_CHAT":return localStorage.setItem("backendActiveQuestionId",t.payload),Object(o.a)({},e,{backendChat:{questionId:t.payload,message:""}});case"SET_CHAT_MESSAGE_TEXT":return Object(o.a)({},e,{backendChat:Object(o.a)({},e.backendChat,{message:t.payload})});default:return e}},A=function(e){var t=e.children,n=Object(a.useReducer)(S,{backendChat:null}),s=Object(i.a)(n,2),u=s[0],c=s[1];return Object(a.useEffect)(function(){var e=localStorage.getItem("backendActiveQuestionId");e&&c({type:"SET_ACTIVE_CHAT",payload:e})},[]),r.a.createElement(_.Provider,{value:[u,c]},t)};function C(){var e=Object(f.a)(["\n  mutation MakeHeartbeatMutation($questionId: ID!) {\n    makeHeartbeat(questionId: $questionId) {\n      id\n    }\n  }\n"]);return C=function(){return e},e}var k=E()(C()),T=r.a.createContext(),w=function(e,t){switch(t.type){case"RESET_SETTINGS":return localStorage.removeItem("clientSettings"),{};case"SET_SETTINGS":return localStorage.setItem("clientSettings",JSON.stringify(t.payload)),Object(o.a)({},t.payload,{messages:JSON.parse(t.payload.messages),standardAnswers:JSON.parse(t.payload.standardAnswers)});default:return e}},N=function(e){var t=e.children,n=Object(a.useReducer)(w,{}),s=Object(i.a)(n,2),u=s[0],c=s[1];return Object(a.useEffect)(function(){var e=localStorage.getItem("clientSettings");e&&c({type:"SET_SETTINGS",payload:JSON.parse(e)})},[]),r.a.createElement(T.Provider,{value:[u,c]},t)},D=function(e){var t=e.status,n=Object(a.useContext)(T),s=Object(i.a)(n,1)[0];return"pending"===t?r.a.createElement("div",{className:"client-status-bar client-status-bar--".concat(t)},s.messages.chatPending):""},$=n(67);function x(){var e=Object(f.a)(["\n  subscription NewMessageSubscription($questionId: ID!) {\n    newMessage(questionId: $questionId) {\n      id\n      text\n      sentFrom\n      createdAt\n      question {\n        id\n        authorName\n      }\n    }\n  }\n"]);return x=function(){return e},e}var Q=E()(x());function H(){var e=Object(f.a)(["\n  subscription QuestionClosedSubscription($questionId: ID!) {\n    questionClosed(questionId: $questionId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return H=function(){return e},e}var M=E()(H());function F(){var e=Object(f.a)(["\n  subscription QuestionAssignedSubscription($questionId: ID) {\n    questionAssigned(questionId: $questionId) {\n      status\n    }\n  }\n"]);return F=function(){return e},e}var R=E()(F());function B(){var e=Object(f.a)(["\n  subscription QuestionReopenedSubscription($questionId: ID) {\n    questionReopened(questionId: $questionId) {\n      id\n      status\n      consultant\n      subject\n      authorName\n      authorEmail\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return B=function(){return e},e}var G=E()(B()),J=function(e){return new Date(1e3*e)},V=n(150),P=n.n(V),K=n(151),X=n.n(K),Y=function(e){var t=X()(e,"DD.MM.YYYY",{locale:P.a}),n=X()(e,"HH:mm",{locale:P.a});return"D. ".concat(t," kl. ").concat(n)},z=function(e){var t=e.sentFrom,n=e.text,s=e.createdAt,u=J(s),c=Object(a.useState)(Y(u)),o=Object(i.a)(c,2),l=o[0],d=o[1];return Object(a.useEffect)(function(){var e=setInterval(function(){d(Y(u))},3e4);return function(){return clearInterval(e)}}),r.a.createElement("div",{className:"client-message client-message--".concat(t)},r.a.createElement("div",{className:"client-message__box"},r.a.createElement("div",{className:"client-message__text"},n)),"system"===t?"":r.a.createElement("div",{className:"client-message__created-at"},l))},L=function(e){if(!e)return!1;var t=e.scrollHeight;e.scrollTop=t},U=function(e){var t=e.disabled,n=e.subject,s=e.questionCreatedAt,u=e.messages,c=e.subscribeToMore,d=e.makeHeartbeat,m=Object(a.useContext)(l),b=Object(i.a)(m,2),f=b[0],v=b[1];Object(a.useEffect)(function(){c({document:Q,variables:{questionId:f.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=Object.assign({},e,Object(o.a)({},e,{question:Object(o.a)({},e.question,{messages:[n.data.newMessage]})}));return e.question.messages&&(a.question.messages=[].concat(Object($.a)(e.question.messages),[n.data.newMessage])),a}}),c({document:R,variables:{questionId:f.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?Object.assign({},e,Object(o.a)({},e,{question:Object(o.a)({},e.question,{},n.data.questionAssigned)})):e}}),c({document:M,variables:{questionId:f.clientChat.questionId},updateQuery:function(e,t){return t.subscriptionData.data?(v({type:"RESET_CHAT",payload:null}),Object.assign({},e,Object(o.a)({},e,{question:null}))):e}}),c({document:G,variables:{questionId:f.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?Object.assign({},e,Object(o.a)({},e,{question:Object(o.a)({},e.question,{},n.data.questionReopened)})):e}})},[]),Object(a.useEffect)(function(){var e=setInterval(function(){d({variables:{questionId:f.clientChat.questionId}})},1e4);return function(){return clearInterval(e)}}),Object(a.useEffect)(function(){L(document.querySelector(".client-messages"))});return r.a.createElement("div",{className:t?"client-messages client-messages--disabled":"client-messages"},function(){if(t)return r.a.createElement("div",{className:"loading"},r.a.createElement("div",null),r.a.createElement("div",null))}(),r.a.createElement(z,{text:n,createdAt:s,sentFrom:"user"}),u.map(function(e,t){return r.a.createElement("div",{key:"client-message-".concat(t,"-").concat(e.id)},r.a.createElement(z,{text:e.text,createdAt:e.createdAt,sentFrom:e.sentFrom}))}))},W=n(114),Z=function(e){var t=e.createMessage,n=e.disabled,s=Object(a.useContext)(l),u=Object(i.a)(s,1)[0],c=Object(a.useState)(""),o=Object(i.a)(c,2),d=o[0],m=o[1],b=Object(a.useRef)();return r.a.createElement("div",{className:"client-form"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),""!==d&&(t({variables:{questionId:u.clientChat.questionId,text:d,sentFrom:"user"}}),m(""))},ref:b},r.a.createElement(W.a,{minRows:2,maxRows:5,value:d,placeholder:"Indtast din besked...",onChange:function(e){return m(e.target.value)},onKeyDown:function(e){13!==e.keyCode||13===e.keyCode&&e.shiftKey||(e.preventDefault(),b.current.dispatchEvent(new Event("submit")))},disabled:n,autoFocus:!0}),r.a.createElement("input",{type:"submit",value:"Send besked"})))},ee=function(){var e=Object(a.useContext)(l),t=Object(i.a)(e,2),n=t[0],s=t[1];return r.a.createElement(b.c,{query:y,variables:{questionId:n.clientChat.questionId}},function(e){var t=e.data,n=e.loading,a=e.subscribeToMore;if(!t||n)return"";var u=t.question.status,c="pending"===u||"complete"===u;return"complete"===t.question.status&&s({type:"RESET_CHAT",payload:null}),r.a.createElement("div",{className:"client-chat"},r.a.createElement(D,{status:t.question.status}),r.a.createElement(b.b,{mutation:k},function(e){return r.a.createElement(U,{disabled:c,subject:t.question.subject,questionCreatedAt:t.question.createdAt,messages:t.question.messages,subscribeToMore:a,makeHeartbeat:e})}),r.a.createElement(b.b,{mutation:h},function(e){return r.a.createElement(Z,{disabled:c,createMessage:e})}))})},te=function(){var e=Object(a.useContext)(l);return Object(i.a)(e,1)[0].clientChat?r.a.createElement(ee,null):r.a.createElement(I,null)},ne=n(68),ae=n(213),re=n(40),se=n(214),ue=n(211),ce=n(7),ie=n(152),oe=new se.a({uri:"https://new.biblioteksvagten.dk/graphql",fetch:ie.a}),le=new ue.a({uri:"wss://new.biblioteksvagten.dk/graphql",fetch:ie.a,options:{reconnect:!0}}),de=Object(re.d)(function(e){var t=e.query,n=Object(ce.j)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation},le,oe),me=new ae.a,be=new ne.c({link:de,cache:me}),fe=function(e){var t=e.children;return r.a.createElement(b.a,{client:be},t)},ve=function(e){var t=e.children;return r.a.createElement(N,null,r.a.createElement(m,null,t))};function Ee(){var e=Object(f.a)(["\n  query {\n    settings {\n      messages\n      standardAnswers\n    }\n  }\n"]);return Ee=function(){return e},e}var ge=E()(Ee()),pe=function(e){var t=e.children,n=e.data,r=e.loading,s=Object(a.useContext)(T),u=Object(i.a)(s,2)[1];return Object(a.useEffect)(function(){n&&!r&&u({type:"SET_SETTINGS",payload:n.settings})},[]),t},qe=function(e){var t=e.children;return r.a.createElement(b.c,{query:ge},function(e){var n=e.data,a=e.loading;return!n||a?t:r.a.createElement(pe,{data:n,loading:a},t)})},Ie=function(){return r.a.createElement(fe,null,r.a.createElement(ve,null,r.a.createElement(qe,null,r.a.createElement(te,null))))};n(536);function je(){var e=Object(f.a)(["\n  query QuestionsQuery($statusType: String!, $consultantId: ID) {\n    questions(statusType: $statusType, consultantId: $consultantId) {\n      id\n      subject\n      authorName\n      authorEmail\n      consultant\n      status\n      source\n      lastHeartbeatAt\n      createdAt\n    }\n  }\n"]);return je=function(){return e},e}var ye=E()(je());function Oe(){var e=Object(f.a)(["\n  subscription NewQuestionSubscription($statusType: String!) {\n    newQuestion(statusType: $statusType) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      source\n      consultant\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return Oe=function(){return e},e}var he=E()(Oe());function _e(){var e=Object(f.a)(["\n  subscription QuestionAssignedToConsultantSubscription($consultantId: ID) {\n    questionAssignedToConsultant(consultantId: $consultantId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return _e=function(){return e},e}var Se=E()(_e()),Ae=n(90),Ce=n.n(Ae);function ke(){var e=Object(f.a)(["\n  mutation AssignQuestionMutation($questionId: ID!, $consultantId: ID!) {\n    assignQuestion(questionId: $questionId, consultantId: $consultantId) {\n      id\n      subject\n      authorName\n      createdAt\n    }\n  }\n"]);return ke=function(){return e},e}var Te=E()(ke()),we=n(212),Ne=n.n(we),De=function(e){var t=J(e);return Ne()(new Date,t)>15},$e=function(e){var t=e.canAssign,n=e.canSetActive,s=e.questionId,u=e.heading,c=e.text,o=e.source,l=e.isActive,d=e.createdAt,m=e.lastHeartbeat,f=e.subscribeToMore,v=J(d),E=window.Drupal&&window.Drupal.settings&&window.Drupal.settings.consultantId?window.Drupal.settings.consultantId.toString():"1",g=Object(a.useState)(!1),p=Object(i.a)(g,2),q=p[0],I=p[1],j=Object(a.useState)(Y(v)),y=Object(i.a)(j,2),O=y[0],h=y[1],S=Object(a.useState)(De(m)),A=Object(i.a)(S,2),C=A[0],k=A[1],T=Object(a.useContext)(_),w=Object(i.a)(T,2),N=w[0],D=w[1];Object(a.useEffect)(function(){var e=setInterval(function(){h(Y(v))},3e4);return function(){return clearInterval(e)}}),Object(a.useEffect)(function(){var e=setInterval(function(){k(De(m))},1e4);return function(){return clearInterval(e)}}),Object(a.useEffect)(function(){f({document:Q,variables:{questionId:s},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newMessage;return"admin"===a.sentFrom?(I(!1),e):N.backendChat&&N.backendChat.questionId&&N.backendChat.questionId===a.question.id?(I(!1),e):(I(!0),e)}})},[N]);return u=C?Ce()(u,20)+" (offline)":Ce()(u,32),r.a.createElement(b.b,{mutation:Te},function(e){return r.a.createElement("div",{className:"question question--teaser ".concat(l&&"question--active"),onClick:function(){var a;t&&(a=e,window.confirm("Vil du overtage dette sp\xf8rgsm\xe5l?")&&a({variables:{questionId:s,consultantId:E}})),n&&(D({type:"SET_ACTIVE_CHAT",payload:s}),I(!1))}},r.a.createElement("div",{className:"question__heading"},r.a.createElement("div",{className:"question__heading__title"},u)),r.a.createElement("div",{className:"question__body"},Ce()(c,35)),r.a.createElement("div",{className:"question__source"},Ce()(o,35)),r.a.createElement("small",{className:"question__created-at"},O),q&&r.a.createElement("small",{className:"question__unread-messages"},"Der er ul\xe6ste beskeder"))})},xe=function(e){var t=e.canAssign,n=e.canSetActive,s=e.title,u=e.questions,c=e.subscriptions,o=e.subscribeToMore,l=window.Drupal&&window.Drupal.settings&&window.Drupal.settings.consultantId?window.Drupal.settings.consultantId.toString():"1",d=Object(a.useContext)(_),m=Object(i.a)(d,1)[0];Object(a.useEffect)(function(){for(var e=0;e<c.length;e++)c[e]()},[]);return r.a.createElement("div",{className:"backend-list"},r.a.createElement("div",{className:"backend-list__heading"},r.a.createElement("h4",{className:"backend-list__heading__title"},s)),r.a.createElement("div",{className:"backend-list__body"},u&&0!==u.length?u.sort(function(e,t){return e.id>t.id?1:-1}).map(function(e){return r.a.createElement("div",{className:l!==e.consultant?"backend-list__item backend-list__item--faded":"backend-list__item",key:"question-".concat(e.id)},r.a.createElement($e,{questionId:e.id,heading:e.authorName,text:e.subject,createdAt:e.createdAt,canAssign:t,canSetActive:n,lastHeartbeat:e.lastHeartbeatAt,readOnly:l!==e.consultant,subscribeToMore:o,isActive:m.backendChat&&m.backendChat.questionId===e.id}))}):r.a.createElement("div",{className:"backend-list__item backend-list__item--no-result"},"Ingen samtaler at vise.")))};function Qe(){var e=Object(f.a)(["\n  subscription QuestionHeartbeatSubscription($questionId: ID) {\n    questionHeartbeat(questionId: $questionId) {\n      id\n      lastHeartbeatAt\n    }\n  }\n"]);return Qe=function(){return e},e}var He=E()(Qe()),Me=function(){var e=[];return r.a.createElement(b.c,{query:ye,variables:{consultantId:null,statusType:"pending"}},function(t){var n=t.loading,a=t.data,s=t.subscribeToMore;return a?n?"Henter...":(e.push(function(){return s({document:he,variables:{consultantId:null,statusType:"pending"},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newQuestion;return Object.assign({},e,{questions:[].concat(Object($.a)(e.questions),[a])})}})}),e.push(function(){return s({document:Se,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionAssignedToConsultant,r=e.questions.filter(function(e){return e.id!==a.id});return Object.assign({},e,{questions:r})}})}),e.push(function(){return s({document:G,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionReopened,r=e.questions.filter(function(e){return e.id!==a.id});return r.push(a),Object.assign({},e,{questions:r})}})}),e.push(function(){return s({document:He,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionHeartbeat,r=e.questions.find(function(e){return e.id===a.id});if(!r)return e;var s=Object(o.a)({},r),u=e.questions.filter(function(e){return e.id!==a.id});return u.push(s),Object.assign({},e,{questions:u})}})}),r.a.createElement(xe,{title:"Chats, Afventer svar",questions:a.questions,subscriptions:e,subscribeToMore:s,canAssign:!0,canSetActive:!0})):""})};function Fe(){var e=Object(f.a)(["\n  subscription AssignedQuestionClosedSubscription($consultantId: ID) {\n    assignedQuestionClosed(consultantId: $consultantId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return Fe=function(){return e},e}var Re=E()(Fe()),Be=function(){var e=[];return r.a.createElement(b.c,{query:ye,variables:{statusType:"assigned",consultantId:null}},function(t){var n=t.loading,a=t.data,s=t.subscribeToMore;return a?n?"Henter...":(e.push(function(){return s({document:Se,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionAssignedToConsultant;return Object.assign({},e,{questions:[].concat(Object($.a)(e.questions),[a])})}})}),e.push(function(){return s({document:Re,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.assignedQuestionClosed,r=e.questions.filter(function(e){return e.id!==a.id});return Object.assign({},e,{questions:r})}})}),e.push(function(){return s({document:G,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionReopened,r=e.questions.filter(function(e){return e.id!==a.id});return Object.assign({},e,{questions:r})}})}),e.push(function(){return s({document:He,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionHeartbeat,r=e.questions.find(function(e){return e.id===a.id});if(!r)return e;var s=Object(o.a)({},r),u=e.questions.filter(function(e){return e.id!==a.id});return u.push(s),Object.assign({},e,{questions:u})}})}),r.a.createElement(xe,{title:"Chats, Ved at blive besvaret",questions:a.questions,subscriptions:e,subscribeToMore:s,canAssign:!1,canSetActive:!0})):""})},Ge=function(){return r.a.createElement("div",{className:"backend-sidebar"},r.a.createElement(Me,null),r.a.createElement(Be,null))};n(542);function Je(){var e=Object(f.a)(["\n  query MessagesQuery($questionId: ID!) {\n    messages(questionId: $questionId) {\n      id\n      text\n      sentFrom\n      createdAt\n    }\n  }\n"]);return Je=function(){return e},e}var Ve=E()(Je()),Pe=function(e){var t=e.lastHeartbeat,n=Object(a.useState)(De(t)),s=Object(i.a)(n,2),u=s[0],c=s[1];return Object(a.useEffect)(function(){var e=setInterval(function(){c(De(t))},1e4);return function(){return clearInterval(e)}}),u?r.a.createElement("div",{className:"backend-notice backend-notice--offline"},"Brugeren er offline..."):r.a.createElement(r.a.Fragment,null)},Ke=function(){return r.a.createElement("div",{className:"backend-notice backend-notice--readonly"},"Du observerer en chat der er tildelt en anden bruger.")},Xe=function(e){var t=e.name,n=e.email,s=e.source,u=Object(a.useContext)(_),c=Object(i.a)(u,2)[1];return r.a.createElement("div",{className:"backend-bar"},r.a.createElement("div",{className:"backend-bar__heading"},r.a.createElement("h2",null,t),r.a.createElement("h3",null,r.a.createElement("a",{href:"mailto:".concat(n)},n)),r.a.createElement("h4",null,s)),r.a.createElement("div",{className:"backend-bar__spacer"}),r.a.createElement("span",{className:"backend-bar__button bar__button--close",onClick:function(){c({type:"RESET_CHAT",payload:null})},title:"Klik for at lukke"},"X"))},Ye=function(e){var t=e.sentFrom,n=e.submittedBy,s=e.text,u=e.createdAt,c=J(u),o=Object(a.useState)(Y(c)),l=Object(i.a)(o,2),d=l[0],m=l[1];return Object(a.useEffect)(function(){var e=setInterval(function(){m(Y(c))},3e4);return function(){return clearInterval(e)}}),r.a.createElement("div",{className:"backend-message backend-message--".concat(t)},r.a.createElement("div",{className:"backend-message__box"},r.a.createElement("div",{className:"backend-message__text"},s)),n&&r.a.createElement("div",{className:"backend-message__submitted-by"},"Af ",n),"system"===t?"":r.a.createElement("div",{className:"backend-message__created-at"},d))},ze=function(e){var t=e.author,n=e.subject,s=e.questionCreatedAt,u=e.messages,c=window.Drupal&&window.Drupal.settings&&window.Drupal.settings.consultantName?window.Drupal.settings.consultantName.toString():"ikke defineret";Object(a.useEffect)(function(){L(document.querySelector(".backend-chat__messages"))});return r.a.createElement("div",{className:"backend-chat__messages"},r.a.createElement(Ye,{text:n,createdAt:s,sentFrom:"user"}),u.map(function(e,n){var a="";return"admin"===e.sentFrom?a=c:"user"===e.sentFrom&&(a=t),r.a.createElement("div",{key:"backend-message-".concat(n,"-").concat(e.id)},r.a.createElement(Ye,{submittedBy:a,text:e.text,createdAt:e.createdAt,sentFrom:e.sentFrom}))}))};function Le(){var e=Object(f.a)(["\n  mutation CloseQuestionMutation(\n    $questionId: ID!\n    $reason: String!\n    $keepConsultant: Boolean\n    $title: String\n  ) {\n    closeQuestion(\n      questionId: $questionId\n      reason: $reason\n      keepConsultant: $keepConsultant\n      title: $title\n    ) {\n      id\n      subject\n      authorName\n      createdAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return Le=function(){return e},e}E()(Le());function Ue(){var e=Object(f.a)(["\n  mutation ReopenQuestionMutation($questionId: ID!) {\n    reopenQuestion(questionId: $questionId) {\n      id\n    }\n  }\n"]);return Ue=function(){return e},e}E()(Ue());var We=r.a.createContext(),Ze=function(e,t){switch(t.type){case"RESET_SETTINGS":return localStorage.removeItem("backendSettings"),{};case"SET_SETTINGS":return localStorage.setItem("backendSettings",JSON.stringify(t.payload)),Object(o.a)({},t.payload,{messages:JSON.parse(t.payload.messages),standardAnswers:JSON.parse(t.payload.standardAnswers)});default:return e}},et=function(e){var t=e.children,n=Object(a.useReducer)(Ze,{messages:null,standardAnswers:null}),s=Object(i.a)(n,2),u=s[0],c=s[1];return Object(a.useEffect)(function(){var e=localStorage.getItem("backendSettings");e&&c({type:"SET_SETTINGS",payload:JSON.parse(e)})},[]),r.a.createElement(We.Provider,{value:[u,c]},t)},tt=function(e){var t=e.createMessage,n=Object(a.useContext)(_),s=Object(i.a)(n,2),u=s[0],c=s[1],o=Object(a.useRef)();return r.a.createElement("div",{className:"backend-form"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),""!==u.backendChat.message&&(t({variables:{questionId:u.backendChat.questionId,text:u.backendChat.message,sentFrom:"admin"}}),c({type:"SET_CHAT_MESSAGE_TEXT",payload:""}))},ref:o},r.a.createElement(W.a,{minRows:2,maxRows:5,value:u.backendChat.message,placeholder:"Indtast din besked...",onChange:function(e){c({type:"SET_CHAT_MESSAGE_TEXT",payload:e.target.value})},onKeyDown:function(e){13!==e.keyCode||13===e.keyCode&&e.shiftKey||(e.preventDefault(),o.current.dispatchEvent(new Event("submit")))},autoFocus:!0})))},nt=function(){var e=window.Drupal&&window.Drupal.settings&&window.Drupal.settings.consultantId?window.Drupal.settings.consultantId.toString():"1",t=Object(a.useContext)(_),n=Object(i.a)(t,2),s=n[0],u=n[1];return r.a.createElement(b.c,{query:y,variables:{questionId:s.backendChat.questionId}},function(t){var n=t.data.question,a=t.loading;return t.subscribeToMore,!n||a?"":("complete"===n.status&&u({type:"RESET_CHAT",payload:null}),r.a.createElement("div",{className:"backend-chat"},r.a.createElement(Xe,{name:n.authorName,email:n.authorEmail,source:n.source}),r.a.createElement(Pe,{lastHeartbeat:n.lastHeartbeatAt}),n.consultant!==e&&r.a.createElement(Ke,null),r.a.createElement(b.c,{query:Ve,variables:{questionId:s.backendChat.questionId},fetchPolicy:"network-only",pollInterval:1e3},function(e){var t=e.data.messages;return e.loading,t?r.a.createElement(ze,{author:n.authorName,subject:n.subject,questionCreatedAt:n.createdAt,messages:t}):null}),n.consultant===e&&r.a.createElement(b.b,{mutation:h,id:n.id},function(e){return r.a.createElement(tt,{questionId:n.id,createMessage:e})})))})},at=function(){var e=Object(a.useContext)(_),t=Object(i.a)(e,1)[0].backendChat?r.a.createElement(nt,null):"";return r.a.createElement(a.Fragment,null,r.a.createElement(Ge,null),t)},rt=function(e){var t=e.children;return r.a.createElement(et,null,r.a.createElement(A,null,t))},st=function(e){var t=e.children,n=e.data,r=e.loading,s=Object(a.useContext)(We),u=Object(i.a)(s,2)[1];return Object(a.useEffect)(function(){n&&!r&&u({type:"SET_SETTINGS",payload:n.settings})},[]),t},ut=function(e){var t=e.children;return r.a.createElement(b.c,{query:ge},function(e){var n=e.data,a=e.loading;return!n||a?t:r.a.createElement(st,{data:n,loading:a},t)})},ct=function(){return r.a.createElement(fe,null,r.a.createElement(rt,null,r.a.createElement(ut,null,r.a.createElement(at,null))))};""!==c("renderOnly")?("backend"===c("renderOnly")&&document.getElementById("chatty_backend")&&u.a.render(r.a.createElement(ct,null),document.getElementById("chatty_backend")),"client"===c("renderOnly")&&document.getElementById("chatty_client")&&u.a.render(r.a.createElement(Ie,null),document.getElementById("chatty_client"))):(document.getElementById("chatty_client")&&u.a.render(r.a.createElement(Ie,null),document.getElementById("chatty_client")),document.getElementById("chatty_backend")&&u.a.render(r.a.createElement(ct,null),document.getElementById("chatty_backend")))}},[[215,1,2]]]);
//# sourceMappingURL=main.78d6cfdb.chunk.js.map