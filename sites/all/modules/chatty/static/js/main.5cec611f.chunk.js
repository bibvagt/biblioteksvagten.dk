(this.webpackJsonpchatty=this.webpackJsonpchatty||[]).push([[0],{48:function(e,t,n){e.exports=n(93)},49:function(e,t,n){},54:function(e,t,n){},63:function(e,t,n){},86:function(e,t,n){},92:function(e,t,n){},93:function(e,t,n){"use strict";n.r(t);n(49);var a=n(0),r=n.n(a),c=n(19),s=n.n(c),u=function(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(a[0]===e)return a[1]}return""},i=n(4),o=n(11);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=r.a.createContext(),b=function(e,t){switch(t.type){case"RESET_CHAT":return localStorage.removeItem("clientActiveQuestionId"),d({},e,{clientChat:null});case"SET_ACTIVE_CHAT":return localStorage.setItem("clientActiveQuestionId",t.payload),d({},e,{clientChat:{questionId:t.payload}});default:return e}},f=function(e){var t=e.children,n=Object(a.useReducer)(b,{clientChat:null}),c=Object(i.a)(n,2),s=c[0],u=c[1];return Object(a.useEffect)((function(){var e=localStorage.getItem("clientActiveQuestionId");e&&u({type:"SET_ACTIVE_CHAT",payload:e})}),[]),r.a.createElement(m.Provider,{value:[s,u]},t)},p=(n(54),n(9)),v=n(7),E=n(8),g=n.n(E);function O(){var e=Object(v.a)(["\n  mutation CreateQuestionMutation(\n    $agencyId: String!\n    $agencyMail: String!\n    $authorName: String!\n    $authorEmail: String!\n    $subject: String!\n    $url: String!\n  ) {\n    createQuestion(\n      data: {\n        authorName: $authorName\n        authorEmail: $authorEmail\n        agencyMail: $agencyMail\n        agencyId: $agencyId\n        subject: $subject\n        url: $url\n      }\n    ) {\n      id\n      subject\n      authorName\n      status\n    }\n  }\n"]);return O=function(){return e},e}var y=g()(O()),j=function(e){var t=e.createQuestion,n=e.loading,c=Object(a.useRef)(""),s=Object(a.useRef)(""),i=Object(a.useRef)(""),o=n;return r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var n=u("agency_id"),a=u("agency_mail"),r=u("url");if(!n||!r)return alert("A needed param was not set.");t({variables:{agencyId:n,agencyMail:a,authorName:c.current.value,authorEmail:s.current.value,subject:i.current.value,url:r}})}},r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--question"},r.a.createElement("label",null,"Hvad vil du sp\xf8rge om?"),r.a.createElement("div",null,r.a.createElement("textarea",{disabled:o,rows:"5",ref:i}))),r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--name"},r.a.createElement("label",null,"Dit navn",r.a.createElement("div",null,r.a.createElement("input",{type:"text",disabled:o,ref:c,required:!0})))),r.a.createElement("div",{className:"question-form__input-wrapper question-form__input-wrapper--email"},r.a.createElement("label",null,"Din e-mail adresse",r.a.createElement("div",null,r.a.createElement("input",{type:"email",disabled:o,ref:s,required:!0})))),r.a.createElement("input",{type:"submit",value:"Sp\xf8rg nu"}))},h=function(){var e=Object(a.useContext)(m),t=Object(i.a)(e,2)[1];return r.a.createElement("div",{className:"question-form"},r.a.createElement(p.b,{mutation:y},(function(e,n){var a=n.loading,c=n.data;return c&&c.createQuestion.id&&t({type:"SET_ACTIVE_CHAT",payload:c.createQuestion.id}),r.a.createElement(j,{createQuestion:e,loading:a})})))};n(63);function _(){var e=Object(v.a)(["\n  query QuestionQuery($questionId: ID!) {\n    question(questionId: $questionId) {\n      id\n      subject\n      authorName\n      authorEmail\n      consultant\n      status\n      source\n      lastHeartbeatAt\n      createdAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return _=function(){return e},e}var q=g()(_());function I(){var e=Object(v.a)(["\n  mutation CreateMessageMutation($questionId: ID!, $sentFrom: String!, $text: String!) {\n    createMessage(questionId: $questionId, data: { text: $text, sentFrom: $sentFrom }) {\n      id\n      text\n      sentFrom\n      createdAt\n      question {\n        id\n        authorName\n      }\n    }\n  }\n"]);return I=function(){return e},e}var S=g()(I());function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=r.a.createContext(),T=function(e,t){switch(t.type){case"RESET_CHAT":return localStorage.removeItem("backendActiveQuestionId"),w({},e,{backendChat:null});case"SET_ACTIVE_CHAT":return localStorage.setItem("backendActiveQuestionId",t.payload),w({},e,{backendChat:{questionId:t.payload,message:""}});case"SET_CHAT_MESSAGE_TEXT":return w({},e,{backendChat:w({},e.backendChat,{message:t.payload})});default:return e}},N=function(e){var t=e.children,n=Object(a.useReducer)(T,{backendChat:null}),c=Object(i.a)(n,2),s=c[0],u=c[1];return Object(a.useEffect)((function(){var e=localStorage.getItem("backendActiveQuestionId");e&&u({type:"SET_ACTIVE_CHAT",payload:e})}),[]),r.a.createElement(C.Provider,{value:[s,u]},t)};function A(){var e=Object(v.a)(["\n  mutation MakeHeartbeatMutation($questionId: ID!) {\n    makeHeartbeat(questionId: $questionId) {\n      id\n    }\n  }\n"]);return A=function(){return e},e}var D=g()(A());function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var x=r.a.createContext(),Q=function(e,t){switch(t.type){case"RESET_SETTINGS":return localStorage.removeItem("clientSettings"),{};case"SET_SETTINGS":return localStorage.setItem("clientSettings",JSON.stringify(t.payload)),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.payload,{messages:JSON.parse(t.payload.messages),standardAnswers:JSON.parse(t.payload.standardAnswers)});default:return e}},$=function(e){var t=e.children,n=Object(a.useReducer)(Q,{}),c=Object(i.a)(n,2),s=c[0],u=c[1];return Object(a.useEffect)((function(){var e=localStorage.getItem("clientSettings");e&&u({type:"SET_SETTINGS",payload:JSON.parse(e)})}),[]),r.a.createElement(x.Provider,{value:[s,u]},t)},H=function(e){var t=e.status,n=Object(a.useContext)(x),c=Object(i.a)(n,1)[0];return"pending"===t?r.a.createElement("div",{className:"client-status-bar client-status-bar--".concat(t)},c.messages.chatPending):""},M=n(16);function R(){var e=Object(v.a)(["\n  subscription NewMessageSubscription($questionId: ID!) {\n    newMessage(questionId: $questionId) {\n      id\n      text\n      sentFrom\n      createdAt\n      question {\n        id\n        authorName\n      }\n    }\n  }\n"]);return R=function(){return e},e}var F=g()(R());function V(){var e=Object(v.a)(["\n  subscription QuestionClosedSubscription($questionId: ID!) {\n    questionClosed(questionId: $questionId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return V=function(){return e},e}var G=g()(V());function B(){var e=Object(v.a)(["\n  subscription QuestionAssignedSubscription($questionId: ID) {\n    questionAssigned(questionId: $questionId) {\n      status\n    }\n  }\n"]);return B=function(){return e},e}var J=g()(B());function K(){var e=Object(v.a)(["\n  subscription QuestionReopenedSubscription($questionId: ID) {\n    questionReopened(questionId: $questionId) {\n      id\n      status\n      consultant\n      subject\n      authorName\n      authorEmail\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return K=function(){return e},e}var X=g()(K()),Y=function(e){return new Date(1e3*e)},L=n(32),z=n.n(L),U=n(33),W=n.n(U),Z=function(e){var t=W()(e,"DD.MM.YYYY",{locale:z.a}),n=W()(e,"HH:mm",{locale:z.a});return"D. ".concat(t," kl. ").concat(n)},ee=function(e){var t=e.sentFrom,n=e.text,c=e.createdAt,s=Y(c),u=Object(a.useState)(Z(s)),o=Object(i.a)(u,2),l=o[0],d=o[1];return Object(a.useEffect)((function(){var e=setInterval((function(){d(Z(s))}),3e4);return function(){return clearInterval(e)}})),r.a.createElement("div",{className:"client-message client-message--".concat(t)},r.a.createElement("div",{className:"client-message__box"},r.a.createElement("div",{className:"client-message__text"},n)),"system"===t?"":r.a.createElement("div",{className:"client-message__created-at"},l))},te=function(e){if(0===e.length)return!1;var t=e.scrollHeight;e.scrollTop=t};function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var re=function(e){var t=e.disabled,n=e.subject,c=e.questionCreatedAt,s=e.messages,u=e.subscribeToMore,o=e.makeHeartbeat,l=Object(a.useContext)(m),d=Object(i.a)(l,2),b=d[0],f=d[1];Object(a.useEffect)((function(){u({document:F,variables:{questionId:b.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=Object.assign({},e,ae({},e,{question:ae({},e.question,{messages:[n.data.newMessage]})}));return e.question.messages&&(a.question.messages=[].concat(Object(M.a)(e.question.messages),[n.data.newMessage])),a}}),u({document:J,variables:{questionId:b.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?Object.assign({},e,ae({},e,{question:ae({},e.question,{},n.data.questionAssigned)})):e}}),u({document:G,variables:{questionId:b.clientChat.questionId},updateQuery:function(e,t){return t.subscriptionData.data?(f({type:"RESET_CHAT",payload:null}),Object.assign({},e,ae({},e,{question:null}))):e}}),u({document:X,variables:{questionId:b.clientChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?Object.assign({},e,ae({},e,{question:ae({},e.question,{},n.data.questionReopened)})):e}})}),[]),Object(a.useEffect)((function(){var e=setInterval((function(){o({variables:{questionId:b.clientChat.questionId}})}),1e4);return function(){return clearInterval(e)}})),Object(a.useEffect)((function(){te(document.querySelector(".client-messages"))}));return r.a.createElement("div",{className:t?"client-messages client-messages--disabled":"client-messages"},function(){if(t)return r.a.createElement("div",{className:"loading"},r.a.createElement("div",null),r.a.createElement("div",null))}(),r.a.createElement(ee,{text:n,createdAt:c,sentFrom:"user"}),s.map((function(e,t){return r.a.createElement("div",{key:"client-message-".concat(t,"-").concat(e.id)},r.a.createElement(ee,{text:e.text,createdAt:e.createdAt,sentFrom:e.sentFrom}))})))},ce=n(24),se=function(e){var t=e.createMessage,n=e.disabled,c=Object(a.useContext)(m),s=Object(i.a)(c,1)[0],u=Object(a.useState)(""),o=Object(i.a)(u,2),l=o[0],d=o[1],b=Object(a.useRef)();return r.a.createElement("div",{className:"client-form"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),""!==l&&(t({variables:{questionId:s.clientChat.questionId,text:l,sentFrom:"user"}}),d(""))},ref:b},r.a.createElement(ce.a,{minRows:2,maxRows:5,value:l,placeholder:"Indtast din besked...",onChange:function(e){return d(e.target.value)},onKeyDown:function(e){(13===e.keyCode&&e.metaKey||13===e.keyCode&&e.ctrlKey)&&b.current.dispatchEvent(new Event("submit"))},disabled:n})))},ue=function(){var e=Object(a.useContext)(m),t=Object(i.a)(e,2),n=t[0],c=t[1];return r.a.createElement(p.c,{query:q,variables:{questionId:n.clientChat.questionId}},(function(e){var t=e.data,n=e.loading,a=e.subscribeToMore;if(!t||n)return"";var s=t.question.status,u="pending"===s||"complete"===s;return"complete"===t.question.status&&c({type:"RESET_CHAT",payload:null}),r.a.createElement("div",{className:"client-chat"},r.a.createElement(H,{status:t.question.status}),r.a.createElement(p.b,{mutation:D},(function(e){return r.a.createElement(re,{disabled:u,subject:t.question.subject,questionCreatedAt:t.question.createdAt,messages:t.question.messages,subscribeToMore:a,makeHeartbeat:e})})),r.a.createElement(p.b,{mutation:S},(function(e){return r.a.createElement(se,{disabled:u,createMessage:e})})))}))},ie=function(){var e=Object(a.useContext)(m);return Object(i.a)(e,1)[0].clientChat?r.a.createElement(ue,null):r.a.createElement(h,null)},oe=n(17),le=n(46),de=n(12),me=n(47),be=n(44),fe=n(2),pe=new me.a({uri:"https://new.biblioteksvagten.dk/graphql"}),ve=new be.a({uri:"wss://new.biblioteksvagten.dk/graphql",options:{reconnect:!0}}),Ee=Object(de.d)((function(e){var t=e.query,n=Object(fe.l)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),ve,pe),ge=new le.a,Oe=new oe.c({link:Ee,cache:ge}),ye=function(e){var t=e.children;return r.a.createElement(p.a,{client:Oe},t)},je=function(e){var t=e.children;return r.a.createElement($,null,r.a.createElement(f,null,t))};function he(){var e=Object(v.a)(["\n  query {\n    settings {\n      messages\n      standardAnswers\n    }\n  }\n"]);return he=function(){return e},e}var _e=g()(he()),qe=function(e){var t=e.children,n=e.data,r=e.loading,c=Object(a.useContext)(x),s=Object(i.a)(c,2)[1];return Object(a.useEffect)((function(){n&&!r&&s({type:"SET_SETTINGS",payload:n.settings})}),[]),t},Ie=function(e){var t=e.children;return r.a.createElement(p.c,{query:_e},(function(e){var n=e.data,a=e.loading;return!n||a?t:r.a.createElement(qe,{data:n,loading:a},t)}))},Se=function(){return r.a.createElement(ye,null,r.a.createElement(je,null,r.a.createElement(Ie,null,r.a.createElement(ie,null))))};n(86);function ke(){var e=Object(v.a)(["\n  query QuestionsQuery($statusType: String!, $consultantId: ID) {\n    questions(statusType: $statusType, consultantId: $consultantId) {\n      id\n      subject\n      authorName\n      authorEmail\n      consultant\n      status\n      source\n      lastHeartbeatAt\n      createdAt\n    }\n  }\n"]);return ke=function(){return e},e}var we=g()(ke());function Ce(){var e=Object(v.a)(["\n  subscription NewQuestionSubscription($statusType: String!) {\n    newQuestion(statusType: $statusType) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      source\n      consultant\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return Ce=function(){return e},e}var Te=g()(Ce());function Ne(){var e=Object(v.a)(["\n  subscription QuestionAssignedToConsultantSubscription($consultantId: ID) {\n    questionAssignedToConsultant(consultantId: $consultantId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return Ne=function(){return e},e}var Ae=g()(Ne()),De=n(21),Pe=n.n(De);function xe(){var e=Object(v.a)(["\n  mutation AssignQuestionMutation($questionId: ID!, $consultantId: ID!) {\n    assignQuestion(questionId: $questionId, consultantId: $consultantId) {\n      id\n      subject\n      authorName\n      createdAt\n    }\n  }\n"]);return xe=function(){return e},e}var Qe=g()(xe()),$e=n(45),He=n.n($e),Me=function(e){var t=Y(e);return He()(new Date,t)>15},Re=function(e){var t=e.canAssign,n=e.canSetActive,c=e.questionId,s=e.heading,u=e.text,o=e.source,l=e.createdAt,d=e.lastHeartbeat,m=e.subscribeToMore,b=Y(l),f=Object(a.useState)(!1),v=Object(i.a)(f,2),E=v[0],g=v[1],O=Object(a.useState)(Z(b)),y=Object(i.a)(O,2),j=y[0],h=y[1],_=Object(a.useState)(Me(d)),q=Object(i.a)(_,2),I=q[0],S=q[1],k=Object(a.useContext)(C),w=Object(i.a)(k,2),T=w[0],N=w[1];Object(a.useEffect)((function(){var e=setInterval((function(){h(Z(b))}),3e4);return function(){return clearInterval(e)}})),Object(a.useEffect)((function(){var e=setInterval((function(){S(Me(d))}),1e4);return function(){return clearInterval(e)}})),Object(a.useEffect)((function(){m({document:F,variables:{questionId:c},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newMessage;return"admin"===a.sentFrom?(g(!1),e):T.backendChat&&T.backendChat.questionId&&T.backendChat.questionId===a.question.id?(g(!1),e):(g(!0),e)}})}),[T]);return s=I?Pe()(s,20)+" (offline)":Pe()(s,32),r.a.createElement(p.b,{mutation:Qe},(function(e){return r.a.createElement("div",{className:"question question--teaser",onClick:function(){var a;t&&(a=e,window.confirm("Vil du overtage dette sp\xf8rgsm\xe5l?")&&a({variables:{questionId:c,consultantId:"666"}})),n&&(N({type:"SET_ACTIVE_CHAT",payload:c}),g(!1))}},r.a.createElement("div",{className:"question__heading"},r.a.createElement("div",{className:"question__heading__title"},s)),r.a.createElement("div",{className:"question__body"},Pe()(u,35)),r.a.createElement("div",{className:"question__source"},Pe()(o,35)),r.a.createElement("small",{className:"question__created-at"},j),E&&r.a.createElement("small",{className:"question__unread-messages"},"Der er ul\xe6ste beskeder"))}))},Fe=function(e){var t=e.canAssign,n=e.canSetActive,c=e.title,s=e.questions,u=e.subscriptions,i=e.subscribeToMore;Object(a.useEffect)((function(){for(var e=0;e<u.length;e++)u[e]()}),[]);return r.a.createElement("div",{className:"backend-list"},r.a.createElement("div",{className:"backend-list__heading"},r.a.createElement("h4",{className:"backend-list__heading__title"},c)),r.a.createElement("div",{className:"backend-list__body"},s&&0!==s.length?s.map((function(e){return r.a.createElement("div",{className:"666"!==e.consultant?"backend-list__item backend-list__item--faded":"backend-list__item",key:"question-".concat(e.id)},r.a.createElement(Re,{questionId:e.id,heading:e.authorName,text:e.subject,createdAt:e.createdAt,canAssign:t,canSetActive:n,lastHeartbeat:e.lastHeartbeatAt,readOnly:"666"!==e.consultant,subscribeToMore:i}))})):r.a.createElement("div",{className:"backend-list__item backend-list__item--no-result"},"Ingen samtaler at vise.")))};function Ve(){var e=Object(v.a)(["\n  subscription QuestionHeartbeatSubscription($questionId: ID) {\n    questionHeartbeat(questionId: $questionId) {\n      id\n      lastHeartbeatAt\n    }\n  }\n"]);return Ve=function(){return e},e}var Ge=g()(Ve());function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Je=function(){var e=[];return r.a.createElement(p.c,{query:we,variables:{consultantId:null,statusType:"pending"}},(function(t){var n=t.loading,a=t.data,c=t.subscribeToMore;return a?n?"Henter...":(e.push((function(){return c({document:Te,variables:{consultantId:null,statusType:"pending"},updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.newQuestion;return Object.assign({},e,{questions:[].concat(Object(M.a)(e.questions),[a])})}})})),e.push((function(){return c({document:Ae,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionAssignedToConsultant,r=e.questions.filter((function(e){return e.id!==a.id}));return Object.assign({},e,{questions:r})}})})),e.push((function(){return c({document:X,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionReopened,r=e.questions.filter((function(e){return e.id!==a.id}));return r.push(a),Object.assign({},e,{questions:r})}})})),e.push((function(){return c({document:Ge,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionHeartbeat,r=e.questions.find((function(e){return e.id===a.id}));if(!r)return e;var c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),s=e.questions.filter((function(e){return e.id!==a.id}));return s.push(c),Object.assign({},e,{questions:s})}})})),r.a.createElement(Fe,{title:"Chats, Afventer svar",questions:a.questions,subscriptions:e,subscribeToMore:c,canAssign:!0,canSetActive:!0})):""}))};function Ke(){var e=Object(v.a)(["\n  subscription AssignedQuestionClosedSubscription($consultantId: ID) {\n    assignedQuestionClosed(consultantId: $consultantId) {\n      id\n      status\n      subject\n      authorName\n      authorEmail\n      consultant\n      source\n      createdAt\n      lastHeartbeatAt\n    }\n  }\n"]);return Ke=function(){return e},e}var Xe=g()(Ke());function Ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Le=function(){var e=[];return r.a.createElement(p.c,{query:we,variables:{statusType:"assigned",consultantId:null}},(function(t){var n=t.loading,a=t.data,c=t.subscribeToMore;return a?n?"Henter...":(e.push((function(){return c({document:Ae,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionAssignedToConsultant;return Object.assign({},e,{questions:[].concat(Object(M.a)(e.questions),[a])})}})})),e.push((function(){return c({document:Xe,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.assignedQuestionClosed,r=e.questions.filter((function(e){return e.id!==a.id}));return Object.assign({},e,{questions:r})}})})),e.push((function(){return c({document:X,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionReopened,r=e.questions.filter((function(e){return e.id!==a.id}));return Object.assign({},e,{questions:r})}})})),e.push((function(){return c({document:Ge,updateQuery:function(e,t){var n=t.subscriptionData;if(!n.data)return e;var a=n.data.questionHeartbeat,r=e.questions.find((function(e){return e.id===a.id}));if(!r)return e;var c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ye(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ye(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r),s=e.questions.filter((function(e){return e.id!==a.id}));return s.push(c),Object.assign({},e,{questions:s})}})})),r.a.createElement(Fe,{title:"Chats, Ved at blive besvaret",questions:a.questions,subscriptions:e,subscribeToMore:c,canAssign:!1,canSetActive:!0})):""}))},ze=function(){return r.a.createElement("div",{className:"backend-sidebar"},r.a.createElement(Je,null),r.a.createElement(Le,null))},Ue=(n(92),function(e){var t=e.lastHeartbeat,n=Object(a.useState)(Me(t)),c=Object(i.a)(n,2),s=c[0],u=c[1];return Object(a.useEffect)((function(){var e=setInterval((function(){u(Me(t))}),1e4);return function(){return clearInterval(e)}})),s?r.a.createElement("div",{className:"backend-notice backend-notice--offline"},"Brugeren er offline..."):r.a.createElement(r.a.Fragment,null)}),We=function(){return r.a.createElement("div",{className:"backend-notice backend-notice--readonly"},"Du observerer en chat der er tildelt en anden bruger.")},Ze=function(e){var t=e.name,n=e.email,c=e.source,s=Object(a.useContext)(C),u=Object(i.a)(s,2)[1];return r.a.createElement("div",{className:"backend-bar"},r.a.createElement("div",{className:"backend-bar__heading"},r.a.createElement("h2",null,t),r.a.createElement("h3",null,r.a.createElement("a",{href:"mailto:".concat(n)},n)),r.a.createElement("h4",null,c)),r.a.createElement("div",{className:"backend-bar__spacer"}),r.a.createElement("span",{className:"backend-bar__button bar__button--close",onClick:function(){u({type:"RESET_CHAT",payload:null})},title:"Klik for at lukke"},"X"))},et=function(e){var t=e.sentFrom,n=e.text,c=e.createdAt,s=Y(c),u=Object(a.useState)(Z(s)),o=Object(i.a)(u,2),l=o[0],d=o[1];return Object(a.useEffect)((function(){var e=setInterval((function(){d(Z(s))}),3e4);return function(){return clearInterval(e)}})),r.a.createElement("div",{className:"backend-message backend-message--".concat(t)},r.a.createElement("div",{className:"backend-message__box"},r.a.createElement("div",{className:"backend-message__text"},n)),"system"===t?"":r.a.createElement("div",{className:"backend-message__created-at"},l))};function tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tt(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var at=function(e){var t=e.subject,n=e.questionCreatedAt,c=e.messages,s=e.subscribeToMore,u=Object(a.useContext)(C),o=Object(i.a)(u,1)[0];Object(a.useEffect)((function(){s({document:F,variables:{questionId:o.backendChat.questionId},updateQuery:function(e,t){var n=t.subscriptionData;return n.data?Object.assign({},e,nt({},e,{question:nt({},e.question,{messages:[].concat(Object(M.a)(e.question.messages),[n.data.newMessage])})})):e}})}),[]),Object(a.useEffect)((function(){te(document.querySelector(".backend-chat__messages"))}));return r.a.createElement("div",{className:"backend-chat__messages"},r.a.createElement(et,{text:t,createdAt:n,sentFrom:"user"}),c.map((function(e,t){return r.a.createElement("div",{key:"backend-message-".concat(t,"-").concat(e.id)},r.a.createElement(et,{text:e.text,createdAt:e.createdAt,sentFrom:e.sentFrom}))})))};function rt(){var e=Object(v.a)(["\n  mutation CloseQuestionMutation(\n    $questionId: ID!\n    $reason: String!\n    $keepConsultant: Boolean\n    $title: String\n  ) {\n    closeQuestion(\n      questionId: $questionId\n      reason: $reason\n      keepConsultant: $keepConsultant\n      title: $title\n    ) {\n      id\n      subject\n      authorName\n      createdAt\n      messages {\n        id\n        text\n        sentFrom\n        createdAt\n      }\n    }\n  }\n"]);return rt=function(){return e},e}var ct=g()(rt());function st(){var e=Object(v.a)(["\n  mutation ReopenQuestionMutation($questionId: ID!) {\n    reopenQuestion(questionId: $questionId) {\n      id\n    }\n  }\n"]);return st=function(){return e},e}var ut=g()(st()),it=function(e){var t=e.children,n=e.title,a=e.toggle,c=e.visible;return r.a.createElement("div",{className:"overlay ".concat(c?"overlay--visible":"")},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"modal__heading"},r.a.createElement("h1",{className:"modal__heading__title"},n)),r.a.createElement("div",{className:"modal__body"},t),r.a.createElement("div",{className:"modal__footer"},r.a.createElement("button",{className:"modal__footer__button",onClick:function(){return a(!c)}},"Luk vindue"))))},ot=function(e){var t=e.closeQuestion,n=e.confirmText,c=e.text,s=e.reason,u=e.data,o=e.loading,l=Object(a.useContext)(C),d=Object(i.a)(l,2),m=d[0],b=d[1];!o&&u&&u.closeQuestion.id&&b({type:"RESET_CHAT",payload:null});var f=function(e){e.preventDefault(),window.confirm(n)&&t({variables:{reason:s,questionId:m.backendChat.questionId}})};return o?r.a.createElement("button",{className:"backend-chat__button backend-chat__button--close-question",onClick:f,disabled:!0},"Vent venligst..."):r.a.createElement("button",{className:"backend-chat__button backend-chat__button--close-question",onClick:f},c)},lt=function(e){var t=e.reopenQuestion,n=Object(a.useContext)(C),c=Object(i.a)(n,2),s=c[0],u=c[1];return r.a.createElement("button",{className:"backend-chat__button backend-chat__button--reopen-question",onClick:function(e){e.preventDefault(),window.confirm("Vil du gen\xe5bne dette sp\xf8rgsm\xe5l?")&&(t({variables:{questionId:s.backendChat.questionId}}),u({type:"RESET_CHAT",payload:null}))}},"Forlad chat")},dt=function(e){var t=e.closeQuestion,n=e.data,c=e.loading,s=Object(a.useContext)(C),u=Object(i.a)(s,2),o=u[0],l=u[1],d=Object(a.useState)(!1),m=Object(i.a)(d,2),b=m[0],f=m[1],p=Object(a.useRef)(""),v=Object(a.useRef)("");!c&&n&&n.closeQuestion.id&&l({type:"RESET_CHAT",payload:null});return c?r.a.createElement("button",{className:"backend-chat__button backend-chat__button--answer-later",disabled:!0},"Vent venligst..."):r.a.createElement("div",null,r.a.createElement("button",{className:"backend-chat__button backend-chat__button--answer-later",onClick:function(e){e.preventDefault(),window.confirm("Vil du besvare dette sp\xf8rgsm\xe5l senere?")&&f(!0)}},"Besvar senere"),b&&r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),t({variables:{questionId:o.backendChat.questionId,reason:"later",title:p.current.value,keepConsultant:v.current.checked}}),f(!1)}},r.a.createElement("div",null,r.a.createElement("strong",null,"Der er behov for ekstra informationer."),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"title"},"Titel"),r.a.createElement("input",{type:"text",id:"title",ref:p})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"keepConsultant"},r.a.createElement("input",{type:"checkbox",id:"keepConsultant",ref:v}),"Jeg besvarer selv sp\xf8rgsm\xe5let"))),r.a.createElement("button",{type:"submit"},"Send")))};function mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var bt=r.a.createContext(),ft=function(e,t){switch(t.type){case"RESET_SETTINGS":return localStorage.removeItem("backendSettings"),{};case"SET_SETTINGS":return localStorage.setItem("backendSettings",JSON.stringify(t.payload)),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mt(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.payload,{messages:JSON.parse(t.payload.messages),standardAnswers:JSON.parse(t.payload.standardAnswers)});default:return e}},pt=function(e){var t=e.children,n=Object(a.useReducer)(ft,{messages:null,standardAnswers:null}),c=Object(i.a)(n,2),s=c[0],u=c[1];return Object(a.useEffect)((function(){var e=localStorage.getItem("backendSettings");e&&u({type:"SET_SETTINGS",payload:JSON.parse(e)})}),[]),r.a.createElement(bt.Provider,{value:[s,u]},t)},vt=function(e){var t=e.modalToggle,n=e.modalVisible,c=Object(a.useContext)(bt),s=Object(i.a)(c,1)[0],u=Object(a.useContext)(C),o=Object(i.a)(u,2)[1],l=s.standardAnswers,d=Object.keys(l).map((function(e,a){var c=e,s=l[e],u=Object.keys(s).map((function(e,a){var c=e,u=s[e];return r.a.createElement("div",{className:"standard-answer",key:"answer-item-".concat(e,"-").concat(a),onClick:function(){return function(e){o({type:"SET_CHAT_MESSAGE_TEXT",payload:e}),t(!n)}(u)}},r.a.createElement("div",{className:"standard-answer__heading"},r.a.createElement("h4",{className:"standard-answer__heading__title"},c)),r.a.createElement("div",{className:"standard-answer__text"},u))}));return r.a.createElement("div",{className:"standard-answer-list__item",key:"answer-".concat(e,"-").concat(a)},r.a.createElement("div",{className:"standard-answer-list__item__heading"},r.a.createElement("h3",{className:"standard-answer-list__item__heading__title"},c)),r.a.createElement("div",{className:"standard-answer-list__item__content"},u))}));return r.a.createElement("div",{className:"standard-answer-list"},d)},Et=function(){var e=Object(a.useState)(!1),t=Object(i.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)(!1),u=Object(i.a)(s,2),o=u[0],l=u[1],d=function(e){l(!1),c(e)},m=function(e){c(!1),l(e)};return r.a.createElement("div",{className:"backend-chat__actions"},r.a.createElement("div",{className:"button-list"},r.a.createElement("div",{className:"button-list__item"},r.a.createElement(it,{toggle:d,visible:n,title:"Standard svar"},r.a.createElement(vt,{modalToggle:d,modalVisible:n})),r.a.createElement("button",{className:"backend-chat__button",onClick:function(){return d(!n)}},"Standard svar")),r.a.createElement("div",{className:"button-list__item"},r.a.createElement("button",{className:"backend-chat__button",onClick:function(){return m(!o)}},"Afslut samtale"),r.a.createElement(it,{toggle:m,visible:o,title:"Afslut samtalen"},r.a.createElement("div",{className:"button-list"},r.a.createElement("div",{className:"button-list__item"},r.a.createElement(p.b,{mutation:ut},(function(e){return r.a.createElement(lt,{reopenQuestion:e})}))),r.a.createElement("div",{className:"button-list__item"},r.a.createElement(p.b,{mutation:ct},(function(e,t){var n=t.loading,a=t.data;return r.a.createElement(ot,{text:"Luk grundet spam",confirmText:"Vil du lukke dette sp\xf8rgsm\xe5l og markere sp\xf8rgsm\xe5let som spam?",reason:"spam",closeQuestion:e,loading:n,data:a})}))),r.a.createElement("div",{className:"button-list__item"},r.a.createElement(p.b,{mutation:ct},(function(e,t){var n=t.loading,a=t.data;return r.a.createElement(ot,{text:"Luk som besvaret",confirmText:"Vil du lukke dette sp\xf8rgsm\xe5l og markere sp\xf8rgsm\xe5let som besvaret?",reason:"answered",closeQuestion:e,loading:n,data:a})}))),r.a.createElement("div",{className:"button-list__item"},r.a.createElement(p.b,{mutation:ct},(function(e,t){var n=t.loading,a=t.data;return r.a.createElement(dt,{closeQuestion:e,loading:n,data:a})}))))))))},gt=function(e){var t=e.createMessage,n=Object(a.useContext)(C),c=Object(i.a)(n,2),s=c[0],u=c[1],o=Object(a.useRef)();return r.a.createElement("div",{className:"backend-form"},r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),""!==s.backendChat.message&&(t({variables:{questionId:s.backendChat.questionId,text:s.backendChat.message,sentFrom:"admin"}}),u({type:"SET_CHAT_MESSAGE_TEXT",payload:""}))},ref:o},r.a.createElement(ce.a,{minRows:2,maxRows:5,value:s.backendChat.message,placeholder:"Indtast din besked...",onChange:function(e){u({type:"SET_CHAT_MESSAGE_TEXT",payload:e.target.value})},onKeyDown:function(e){(13===e.keyCode&&e.metaKey||13===e.keyCode&&e.ctrlKey)&&o.current.dispatchEvent(new Event("submit"))}})))},Ot=function(){var e=Object(a.useContext)(C),t=Object(i.a)(e,2),n=t[0],c=t[1];return r.a.createElement(p.c,{query:q,fetchPolicy:"network-only",variables:{questionId:n.backendChat.questionId}},(function(e){var t=e.data,n=e.loading,a=e.subscribeToMore;return t&&t.question&&!n?("complete"===t.question.status&&c({type:"RESET_CHAT",payload:null}),r.a.createElement("div",{className:"backend-chat"},r.a.createElement(Ze,{name:t.question.authorName,email:t.question.authorEmail,source:t.question.source}),r.a.createElement(Ue,{lastHeartbeat:t.question.lastHeartbeatAt}),"666"!==t.question.consultant&&r.a.createElement(We,null),r.a.createElement(at,{subject:t.question.subject,questionCreatedAt:t.question.createdAt,messages:t.question.messages,subscribeToMore:a}),"666"===t.question.consultant&&r.a.createElement(Et,null),"666"===t.question.consultant&&r.a.createElement(p.b,{mutation:S},(function(e){return r.a.createElement(gt,{createMessage:e})})))):""}))},yt=function(){var e=Object(a.useContext)(C),t=Object(i.a)(e,1)[0].backendChat?r.a.createElement(Ot,null):"";return r.a.createElement(a.Fragment,null,r.a.createElement(ze,null),t)},jt=function(e){var t=e.children;return r.a.createElement(pt,null,r.a.createElement(N,null,t))},ht=function(e){var t=e.children,n=e.data,r=e.loading,c=Object(a.useContext)(bt),s=Object(i.a)(c,2)[1];return Object(a.useEffect)((function(){n&&!r&&s({type:"SET_SETTINGS",payload:n.settings})}),[]),t},_t=function(e){var t=e.children;return r.a.createElement(p.c,{query:_e},(function(e){var n=e.data,a=e.loading;return!n||a?t:r.a.createElement(ht,{data:n,loading:a},t)}))},qt=function(){return r.a.createElement(ye,null,r.a.createElement(jt,null,r.a.createElement(_t,null,r.a.createElement(yt,null))))};""!==u("renderOnly")?("backend"===u("renderOnly")&&document.getElementById("chatty_backend")&&s.a.render(r.a.createElement(qt,null),document.getElementById("chatty_backend")),"client"===u("renderOnly")&&document.getElementById("chatty_client")&&s.a.render(r.a.createElement(Se,null),document.getElementById("chatty_client"))):(document.getElementById("chatty_client")&&s.a.render(r.a.createElement(Se,null),document.getElementById("chatty_client")),document.getElementById("chatty_backend")&&s.a.render(r.a.createElement(qt,null),document.getElementById("chatty_backend")))}},[[48,1,2]]]);
//# sourceMappingURL=main.5cec611f.chunk.js.map